#调试脚本程序
脚本程序的调试通常都很容易，但并没有特定的工具帮助我们进行调试。在本节中，我们将简单讲述一些常用的方法。

出现错误时，shell一般都会打印出包含错误的行的行号。如果这个错误并不是非常明显，你可以添加一些额外的echo语句来显示变量的内容，也可以通过在shell中交互式地输入代码片段来对它们进行测试。

因为脚本程序是解释执行的，所以在脚本程序的修改和重试过程中没有编译方面的额外开支。跟踪脚本程序中复杂错误的主要方法是设置各种shell选项。为此，你可以在调用shell时加上命令行选项，或是使用set命令。表2-21列出了各种选项。

```text
命令行选项 			set选项 		说明
sh –n <script> 		set –o noexec 	只检查语法错误，不执行命令
					set -n
sh –v <script> 		set –o verbose 	在执行命令之前回显它们
					set –v
sh –x <script> 		set –o xtrace 	在处理完命令之后回显它们
					set –x
sh –u <script> 		set –o nounset 	如果使用了未定义的变量，就给出出错消息
					set –u
```
你可以用`-o`选项启用set命令的选项标志，用`+o`选项取消设置，对简写版本也是一样的处理方法。你可以通过使用`xtrace`选项来得到一份简单的执行跟踪报告。在调试的初始阶段，你可以先使用命令行选项的方法，但如果想获得更好的调试效果，你可以将`xtrace`标志（用来启用或关闭执行命令的跟踪）放到脚本程序中问题代码的前后。执行跟踪功能让shell在执行每行语句之前，先输出该行并对该行中变量进行扩展。

使用下面的命令来启用xtrace选项：
```bash
set -o xtrace
```
再用下面的命令来关闭xtrace选项：
```bash
set +o xtrace
```
默认情况下，变量扩展的层次由每行代码前的`+`号个数指出。你可以通过对shell配置文件中的shell变量PS4进行设置，将`+`号修改为更有意义的字符。

在shell中，你还可以通过捕获EXIT信号，从而在脚本程序退出时查看到程序的状态。具体做法是在脚本程序的开始处添加类似下面这样的一条语句：
```text
trap 'echo Exiting:critical variable = $critical_variable' Exit
```

