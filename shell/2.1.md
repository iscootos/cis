#find命令
你将看到的第一个命令是find。这是个用于搜索文件的命令，它极其有用，但Linux初学者常常觉得它不易使用，这不仅仅是因为它有选项、测试和动作类型的参数，还因为其中一个参数的处理结果可能会影响到后续参数的处理。 

在深入研究这些选项、测试和参数之前，让我们首先看一个非常简单的例子，它用来在本地机器上查找名为test的文件。为了确保你具有搜索整个机器的权限，请以root用户身份来执行这个命令：

```bash
find / -name test -print
```
根据你所使用系统的不同，你可能还会找到其他几个名称也为test的文件。正如你可能猜测的那样，这个命令的含义是：从根目录开始查找名为test的文件，并且输出该文件的完整路径。这非常简单。

然而，这个命令的执行确实需要花费很长的时间，并且网络上的Windows机器的硬盘也会高速转动。这是因为Linux机器挂载(使用SAMBA)了一大块Windows机器的文件系统，看起来似乎是Windows文件系统也被搜索了，尽管我们知道要查找的文件应该在Linux机器上。 		

这就是我们要介绍的第一个选项发挥作用的时候了。如果你指定`-mount`选项，你就可以告诉find命令不要搜索挂载的其他文件系统的目录。

```bash
find / -mount -name test -print
```
我们仍然能找到文件，但这次搜索速度会更快，同时也不必再搜索挂载的其他文件系统。 		

find命令的完整语法格式如下所示：

```text
find [path] [options] [tests] [actions]
```
`path`部分很容易理解：你既可以使用绝对路径，如/bin，也可以使用相对路径，如.。如果需要，你也可以指定多个路径，如find /var /home。 	

`find`命令有许多选项可用，下面列出了一些主要的选项。

```text
选项 				含义
-depth				在查看目录本身之前先搜索目录的内容
-follow 			跟随符号链接
-maxdepths N 		最多搜索N层目录
-mount(或-xdev) 	不搜索其他文件系统中的目录
```
下面是测试部分。可以提供给`find`命令的测试非常多，每种测试返回的结果有两种可能：`true`或`false`。`find`命令开始工作时，它按照顺序将定义的每种测试依次应用到它搜索到的每个文件上。如果一个测试返回`false`，`find`命令就停止处理它当前找到的这个文件，并继续搜索。如果一个测试返回`true`，`find`命令将继续下一个测试或对当前文件采取行动。下表只列出了最常用的测试，请参考`find`命令的手册页以了解所有可以使用的测试。

```text
测试				含义
-atime N 			文件在N天之前被最后访问过
-mtime N 			文件在N天之前被最后修改过
-name pattern 		文件名(不包括路径名)匹配提供的模式pattern，为了确保pattern被传递给find命令而不是由shell来处理，pattern必须总是用引号括起
-newer otherfile 	文件比otherfile文件要新
-type c 			文件的类型为c，c是一个特殊类型。最常见的是d(目录)和f(普通文件)。其他可用的类型请参考手册页
-user username 		文件的拥有者是指定的用户username
```
你还可以用操作符来组合测试。大多数操作符有两种格式：短格式和长格式，如下所示。
```text
操作符，短格式 		操作符，长格式 		含义
! 						-not 			测试取反
-a 						-and 			两个测试都必须为真
-o 						-or 			两个测试有一个必须为真
```
你可以通过使用圆括号来强制测试和操作符的优先级。由于圆括号对shell来说有其特殊的含义，所以你还必须使用反斜线来引用圆括号。此外，如果你在文件名处使用的是匹配模式，你就必须在模式上使用引号以确保模式没有被shell扩展，而是直接传递给`find`命令。例如，如果你想写一个测试"搜索的文件比文件X要新，或者文件名以下划线开头"，你可以这样写

```bash
\(-newer X -o -name "_*" \)
```
在当前目录下搜索比文件while2要新的文件

```bash
find . -newer while2 -print
```
这个结果看起来不错，不过在结果中还包括了当前目录，而这并不是你想要的，你只对普通文件感兴趣。所以你会增加一个额外的测试`-type f`：

```bash
find . -newer while2 -type f -print
```
它是如何工作的呢？你指定find命令应该在当前目录`.`中搜索比文件while2要新的文件`-newer while2`，如果这个测试通过，然后再测试这个文件是否是一个普通文件`-type f`。最后，你使用前面已经讲过的`-print`来确认搜索到的文件。 				

现在来查找以下划线开头的文件或比while2文件要新的文件，但在两种情况下都必须是普通文件。这个例子将演示如何使用圆括号来对测试进行组合：

```bash
find . \( -name "_*" or -newer while2 \) -type f -print
```
可以看出完成这个任务并不是很困难。你必须转义圆括号使得它们不会被shell处理，而且还需要将`*`号用引号括起使得它被直接传递给`find`命令。 		

现在你已可以可靠地搜索文件了。下面来看看在发现匹配指定条件的文件之后，你可以执行的动作。下面只列出了最常见的动作，完整的动作列表请见find命令的手册页。 				

`-exec`和`-ok`命令将命令行上后续的参数作为它们参数的一部分，直到被`\;`序列终止。实际上，`-exec`和`-ok`命令执行的是一个嵌入式命令，所以嵌入式命令必须以一个转义的分号结束，使得`find`命令可以决定什么时候它可以继续查找用于它自己的命令行选项。魔术字符串`{}`是`-exec`或`-ok`命令的一个特殊类型的参数，它将被当前文件的完整路径取代。

```text
动作			含义
-exec command 	执行一条命令。这是最常见的动作之一。请见这个表格之后的解释以了解参数是如何传递给这个命令的。这个动作必须使用\;字符对来结束
-ok command 	与-exec类似，但它在执行命令之前会针对每个要处理的文件，提示用户进行确认。这个动作必须使用\;字符对来结束
-print 			打印文件名
-ls 			对当前文件使用命令ls–dils
```
上面的解释可能并不容易理解，但通过一个例子可以将其解释得更清楚。我们来看一个比较简单的例子，它使用一条非常安全的命令ls：
```bash
find . -newer while2 -type -f ls -l {} \;
```
如你所见，find命令非常有用。你只需通过一点练习就可以很好地掌握它。无论如何，这点练习是完全值得的，所以请使用find命令来进行实验。


