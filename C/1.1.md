#使用automake/autoconf生成makefile
无论是在Linux还是在Unix环境中，make都是一个非常重要的编译命令。不管是自己进行项目开发还是安装应用软件，我们都经常要用到make或 make install。利用make工具，我们可以将大型的开发项目分解成为多个更易于管理的模块，对于一个包括几百个源文件的应用程序，使用make和 makefile工具就可以轻而易举的理顺各个源文件之间纷繁复杂的相互关系        
但是如果通过查阅make的帮助文档来手工编写Makefile,对任何程序员都是一场挑战。幸而有GNU 提供的Autoconf及Automake这两套工具使得编写makefile不再是一个难题           
本文将介绍如何利用 GNU Autoconf 及 Automake 这两套工具来协助我们自动产生 Makefile文件，并且让开发出来的软件可以像大多数源码包那样，只需"./configure", "make","make install" 就可以把程序安装到系统中          
![image002.gif](image002.gif)       
####所需工具
在开始使用automake之前，首先确认你的系统安装如下软件
```text
yum -y install autoconf automake m4 perl libtool
```
autoconf是一个用于生成可以自动地配置软件源码包，用以适应多种UNIX类系统的shell脚本工具，其中autoconf需要用到 m4，便于生成脚本。           
automake是一个从Makefile.am文件自动生成Makefile.in的工具。为了生成Makefile.in，automake还需用到perl，由于automake创建的发布完全遵循GNU标准，所以在创建中不需要perl。libtool是一款方便生成各种程序库的工具        

目前automake支持三种目录层次：flat、shallow和deep       
1.flat指的是所有文件都位于同一个目录中，就是所有源文件、头文件以及其他库文件都位于当前目录中，且没有子目录。Termutils就是这一类        
2.shallow指的是主要的源代码都储存在顶层目录，其他各个部分则储存在子目录中。就是主要源文件在当前目录中，而其它一些实现各部分功能的源文件位于各自不同的目录。automake本身就是这一类。        
3.deep指的是所有源代码都被储存在子目录中；顶层目录主要包含配置信息.就是所有源文件及自己写的头文件位于当前目录的一个子目录中，而当前目录里没有任何源文件。 GNU cpio和GNU tar就是这一类          

flat类型是最简单的，deep类型是最复杂的。不难看出，我们的模拟需求正是基于第三类deep型，也就是说我们要做挑战性的事情：)。注：我们的测试程序是基于多线程的简单程序
####创建configure.in文件
```bash
autoscan
```
执行上面的命令，在当前目录生成`autoscan.log`和`configure.scan`，把`configure.scan`修改为`configure.in`        
```bash
mv configure.scan configure.in
```
```bash
vi configure.in
```
```text
#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.

AC_PREREQ([2.63])
AC_INIT([FULL-PACKAGE-NAME], [VERSION], [BUG-REPORT-ADDRESS])
AC_CONFIG_SRCDIR([one.c])
AC_CONFIG_HEADERS([config.h])

# Checks for programs.
AC_PROG_CC

# Checks for libraries.

# Checks for header files.

# Checks for typedefs, structures, and compiler characteristics.

# Checks for library functions.

AC_OUTPUT
```
`AC_PREREQ`表示文件要求的autoconf的版本       
`AC_INIT`定义了程序的名称，版本，和错误报告地址，一般情况下BUG-DEPORT-ADDRESS可以省略，用户可以根据自己的需求定制         
另外还需要添加`AM_INIT_AUTOMAKE()`语句        
`AC_CONFIG_SRCFIR([hello.c])`检查源文件是否存在       
`AC_CONFIG_HEADERS([config.h])`用来生成config.h文件，此句和上一句一般不用修改         
`AC_OUTPUT`用来指定生成的Makefile        
修改后的configure.in
```text
#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.

AC_PREREQ([2.63])
AC_INIT(one, 1.0)
AM_INIT_AUTOMAKE(one, 1.0)
AC_CONFIG_SRCDIR([one.c])
AC_CONFIG_HEADERS([config.h])

# Checks for programs.
AC_PROG_CC

# Checks for libraries.

# Checks for header files.

# Checks for typedefs, structures, and compiler characteristics.

# Checks for library functions.

AC_OUTPUT
```
####创建Makefile.am文件
```text
AUTOMAKE_OPTIONS=foreign
bin_PROGRAMS=one
one_SOURCES=one.c
```
`AUTOMAKE_OPTIONS`用来设置automake的软件等级，可用选项有forrign，gnu，gnits，foreign表示只检测必要文件           
`bin_PROGRAMS`用来指定生成的可执行文件，多个时，用空格分开        
`one_SOURCES`用来指定生成可执行文件的依赖文件，多个依赖文件用空格分开         
