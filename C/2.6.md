#epoll
EPOLL有边缘模式ET，水平模式LT        
默认为LT，也就是阻塞模式       
如果设置为ET模式，也就是非阻塞模式，套接字必须设置为非阻塞模式         
####epoll_create函数
创建一个epoll句柄，size用来告诉内核这个监听的数目有多大，当创建好epoll句柄后，它就会占用一个fd值，在linux下查看/proc/进程id/fd/，是能够看到这个fd的，所以在使用完epoll后，必须调用close关闭它，否则可能导致fd被耗尽
```c
#include <sys/epoll.h>

int epoll_create(int size);
```
返回值，成功返回一个大于0的正整数，否则失败         
返回一个epoll专用的文件描述符，它其实是在内核申请一块空间，用来存放您想关注的socketfd是否发生以及发生了什么事件，size就是您在这个epoll fd上所能关注的最大socket fd数量，随您设置，只要你有空间  
注意: size参数只是告诉内核这个epoll对象会处理的事件大致数目。而不是能够处理的事件的最大个数。在Linux最新的一些内核版本的实现中，这个size参数没有任何意义       
####epoll_ctl函数
向epoll对象中，添加，修改，删除感兴趣的事件，也就是注册事件
```c
#include <sys/epoll.h>

int epoll_ctl(int epfd, int op, int fd, struct epoll_event* event);
```
返回值，0表示成功，-1失败       
epfd参数，就是创建的epoll句柄     
op参数，有三个选项
```text
EPOLL_CTL_ADD   添加新的事件到epoll中
EPOLL_CTL_MOD   修改epoll中的事件
EPOLL_CTL_DEL   删除epoll中的事件
```
fd参数，需要监听的套接字         
event参数，是一个struct epoll_event结构指针，用来给fd参数注册事件     
```c
typedef union epoll_data {
	void *ptr;
	int fd;
	__uint32_t u32;
	__uint64_t u64;
} epoll_data_t;

struct epoll_event {
	__uint32_t events;
	epoll_data_t data;	
};
```
struct epoll_event结构中的events成员，可以是以下几个宏的集合
```text
EPOLLIN         文件描述符可读(包括对端socket正常关闭)
EPOLLOUT        文件描述符可写
EPOLLRDHUP      表示TCP连接的远端关闭或半关闭连接
EPOLLPRI        文件描述符有带外数据可读
EPOLLERR        文件描述符发送错误
EPOLLHUP        文件描述符被挂断
EPOLLET         边缘模式Edge Triggered， 系统默认为水平模式LT
EPOLLONESHOT    表示对这个事件只处理一次，下次需要处理时需要重新加入epoll
```
####epoll_wait函数
该函数轮询I/O事件的发生
```c
#include <sys/epoll.h>

int epoll_wait(int epfd, struct epoll_event* events, int maxevents, int timeout);
```
返回值，0表示超时，-1表示错误，大于0表示返回的需要处理的事件数目         
epfd参数，就是创建的epoll句柄        
events参数，分配好的epoll_event结构数组，epoll将会把发生的事件复制到events数组中(events不可以是空指针，内核只负责把数据复制到这个events数组中，不会动态分配内存，内核这种做法效率很高)         
maxevents参数，表示本次可以返回的最大事件数目，通常maxevents参数与预分配的events数组的大小相等，同时不能大于创建epoll句柄的size参数        
timeout参数，表示等待事件的超时事件，单位毫秒，0表示立即返回    

