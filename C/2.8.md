#fcntl
####fcntl函数
fcntl函数可以改变已打开的文件的性质
```c
#include <fcntl.h>

int fcntl(int filedes, int cmd, ... /* int arg */ );
```
返回值，若成功则依赖于cmd，若出错返回-1          

fcntl函数有5种功能         
1.复制一个现有的描述符 cmd=F_DUPFD      
2.获得/设置文件描述符标记 cmd=F_GETFD或F_SETFD        
3.获得/设置文件状态标志 cmd=GETFL或F_SETFL         
4.获得/设置异步I/O所有权 cmd=F_GETOWN或F_SETOWN        
5.获得/设置记录锁cmd=F_GETLK、F_SETLK或F_SETLKW       

######F_DUPFD
复制文件描述符filedes。新文件描述符作为函数值返回。它是尚未打开的各描述符中大于 或等于第三个参数值(取为整型值)中各值的最小值。新描述符与filedes共享同一文件表项。但是，新描述符有它自己的一套文件描述符标 志，其FD_CLOEXEC文件描述符标志被清除(这表示该描述符在通过一个exec时仍保持有效)
######F_GETFD
对应于filedes的文件描述符标志作为函数值返回。当前只定义了一个文件描述符标志FD_CLOEXEC
######F_SETFD
对于filedes设置文件描述符标志。新标志值按第三个参数(取为整型值)设置        
应当了解很多现有的涉及文件描述符标志的程序并不使用常量FD_CLOEXEC，而是将此标志设置为0(系统默认，在exec时不关闭)或1(在exec时关闭)
######F_GETFL
对应于filedes的文件状态标志作为函数值返回。在说明open函数时，已说明了文件状态标志
```text
文件状态标志        说明
O_RDONLY            只读打开
O_WRONLY            只写打开
O_RDWR              为读、写打开
O_APPEND            每次写时追加
O_NONBLOCK          非阻塞模式
O_SYNC              等待写完成(数据和属性)
O_DSYNC             等待写完成(仅数据)
O_RSYNC             同步读、写
O_FSYNC             等待写完成(仅FreeBSD和Mac OS X)
O_ASYNC             异步I/O(仅FreeBSD和Mac OS X)
```
不幸的是，三个访问方式标志（O_RDONLY、O_WRONLY以及O_RDWR）并不各占1位（正如前述，这三种标志的值分别是0、1和2，由于历史原因。这三种值互斥一个文件只能有这三种值之一）。因此首先必须用屏蔽字O_ACCMODE取得访问模式位，然后将结果与这三种值中的任一种作比较
######F_SETFL
将文件状态标志设置为第三个参数的值(取为整型值)。可以更改的几个标志是：O_APPEND、O_NONBLOCK、O_SYNC、O_DSYNC、O_RSYNC、 O_FSYNC和O_ASYNC
######F_GETOWN
取当前接收SIGIO和SIGURG信号的进程ID或进程组ID。
######F_SETOWN
设置接收SIGIO和SIGURG信号的进程ID或进程组ID。正的arg 指定一个进程ID，负的arg 表示等于arg 绝对值的一个进程组ID

fcntl的返回值与命令有关。如果出错，所有命令都返回-1，如果成功则返回某个其他值。下列四个命令有特 定返回值：F_DUPFD、F_GETFD、F_GETFL以及F_GETOWN。第一个返回新的文件描述符，接下来的两个返回相应标志，最后一个返回一个正的进程ID或负的进程组ID
####FD_CLOEXEC
当我们打开文件描述符之后，默认是没有设置FD_CLOEXEC标志的，FD_CLOEXEC就是close-on-exec，意思就是，当一个进程在fork之后执行exec的时候，把设置有FD_CLOEXEC标志的文件描述符关闭。       
默认情况下，打开的文件描述符，在主进程，子进程，exec程序里面都可以访问，但是一般exec程序根本不需要使用这些文件描述符，所以推荐设置FD_CLOEXEC以关闭这些无用的文件描述符        

